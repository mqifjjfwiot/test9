<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace속성:매퍼파일의 완전한경로 .xml는 생략 -->
<!-- ※ibatis와는 다르게 id값에 .(dot)를 사용 못한다. -->
<mapper namespace="onememo.mybatis.mapper.test">
	
	<insert id="myInsert" parameterType="testDTO">
		INSERT INTO MEMBER VALUES(no.nextval,#{id},#{pwd},#{name},#{addr},#{tel},#{mail},default)
	</insert>
	<select id="myMemberCnt" resultType="int" parameterType="testDTO">
		SELECT COUNT(*) FROM member WHERE id=#{id}
	</select>
	<select id="selectMyMemberInfo" resultType="testDTO" parameterType="testDTO">
		SELECT * FROM member WHERE id=#{id}
	</select>
	<update id="memberUpdate" parameterType="testDTO">
		UPDATE member SET pwd = #{pwd} , name = #{name} , addr = #{addr} , tel = #{tel}, mail = #{mail}
		WHERE id = #{id}	
	</update>
	
	<select id="memoIsLogin" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM member WHERE id=#{id} AND pwd=#{pwd}		
	</select>
	<select id="memoTotalCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM board b JOIN member m ON b.id=m.id
		<if test="searchWord !=null">
			WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>		
	</select>
	
	<select id="memoSelectList" parameterType="Map" resultType="testDTO">
		SELECT * FROM
		(SELECT T.*,ROWNUM R FROM (SELECT b.*,m.name,(SELECT COUNT(*) FROM linecomments WHERE lno=b.bono) as commentcount FROM
		member m JOIN board b ON m.id= b.id
		<if test="searchWord !=null">
			WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>
		
		ORDER BY bono DESC) T)
		WHERE R BETWEEN #{start} AND #{end}	
	</select>
	<insert id="memoInsert" parameterType="Map">
		INSERT INTO BOARD 
		VALUES(SEQ_BOARD.NEXTVAL,#{id},#{sno},'ex',DEFAULT,#{bcontent},DEFAULT)
	</insert>
	<!-- 
		BONO varchar2(200) NOT NULL PRIMARY KEY,
		ID varchar2(20) NOT NULL,
		SNO varchar2(200) NOT NULL,
		CATEGORY varchar2(200) NOT NULL,
		BDATE date DEFAULT SYSDATE NOT NULL,
		BCONTENT nvarchar2(200) NOT NULL,
		BOARDCOMPLETE varchar2(10) DEFAULT '0' NOT NULL
	 -->
	
	<select id="memoSelectOne" resultType="testDTO" parameterType="Map">
		SELECT b.*,m.name FROM
		member m JOIN board b ON m.id= b.id
		WHERE bono = #{bono}
	</select>
	<delete id="memoDelete" parameterType="Map">
		DELETE board WHERE bono=#{bono}
	</delete>

	<delete id="itemsDelete" parameterType="Map">
		DELETE ITEMS WHERE INO=#{INO}
	</delete>
	
	<insert id="itemsInsert" parameterType="Map">
		INSERT INTO ITEMS 
		VALUES(SEQ_ITEMS.NEXTVAL,#{MNO},#{LNO},#{IMAGE},#{IMAGES2},#{INAME},#{INAME2},#{INAME3},
		,#{PRICE},#{IPAGE},#{IPAGE2},#{CATEORY},#{STOCK},#{HASHTAG},#{DISH},#{BRAND},#{PNO})
	</insert>
	
	
	<update id="itemsUpdate" parameterType="Map">
		UPDATE ITEMS SET IMAGE=#{IMAGE}, INAME = #{INAME}, INAME2=#{INAME2}, PRICE=#{PRICE}
		WHERE CATEGORY=#{CATEGORY}	
	</update>
	<!--
	<select id="itemsSelectOne" resultMap="itemsDTOResult" parameterType="Map">
		SELECT * FROM ITEMS WHERE INO = #{INO}
	</select>
	 
	<select id="itemsShopping" resultMap="itemsDTOResult" parameterType="Map">
		SELECT i.* FROM
		BASKET b JOIN ITEMS i ON b.INO= i.INO
		WHERE BNO = #{BNO}
	</select>
	-->

</mapper>